<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xml:lang="en" lang="en"
      i18n:domain="ims.upload"
      metal:use-macro="here/main_template/macros/master">

  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <metal:css fill-slot="style_slot">
      <link rel="stylesheet" type="text/css" media="screen" tal:attributes="href string:${portal_url}/++resource++ims.upload/css/bootstrap.css">
      <link rel="stylesheet" type="text/css" media="screen" tal:attributes="href string:${portal_url}/++resource++ims.upload/css/bootstrap-theme.css">

      <link rel="stylesheet" tal:attributes="href string:${portal_url}/++resource++ims.upload/blueimp/css/jquery.fileupload.css">
      <noscript><link rel="stylesheet" tal:attributes="href string:${portal_url}/++resource++ims.upload/blueimp/css/jquery.fileupload-noscript.css"></noscript>
      <noscript><link rel="stylesheet" tal:attributes="href string:${portal_url}/++resource++ims.upload/blueimp/css/jquery.fileupload-ui-noscript.css"></noscript>
    </metal:css>

    <metal:javascript fill-slot="javascript_head_slot">
      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/js/bootstrap.min.js"></script>

      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/blueimp/js/load-image.min.js"></script>
      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/blueimp/js/canvas-to-blob.min.js"></script>
      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/blueimp/js/jquery.iframe-transport.js"></script>
      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/blueimp/js/jquery.fileupload.js"></script>
      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/blueimp/js/jquery.fileupload-process.js"></script>
      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/blueimp/js/jquery.fileupload-image.js"></script>
      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/blueimp/js/jquery.fileupload-validate.js"></script>


    </metal:javascript>
  </head>

  <div metal:fill-slot="content-title">
    <h1>Upload Files to <span tal:replace="context/title|string:Folder" /></h1>
  </div>

  <body>
    <div metal:fill-slot="content-core">
      <br>
      <input id="can_delete" name="can_delete" type="hidden" tal:attributes="value view/can_delete" />
      <form id="fileupload-chunkless" class="uploadForm" enctype="multipart/form-data" method="POST"
            tal:attributes="action string:${context/absolute_url}/chunkless-upload">

        <span class="btn btn-success fileupload-chunkless">
            <i class="glyphicon glyphicon-plus"></i>
            <span>Add file:</span>
            <!-- The file input field used as target for the file upload widget -->
            <input id="fileupload-chunkless-button" type="file" name="files[]">
        </span>
        <button class="btn btn-primary" id="uploadChunkless" type="submit">
          <i class="glyphicon glyphicon-upload"></i>
          Upload
        </button>

        <p>
          Your current browser does not support multi-file chunked uploads. You may upload single files in your current
          browser or switch browsers to utilize more features.
        </p>

        <p>
          Partial list of browsers with full support:
        </p>
        <ul>
          <li>Internet Explorer &gt;=10</li>
          <li>Firefox</li>
          <li>Chrome</li>
          <li>Safari</li>
          <li>Opera</li>
        </ul>
      </form>

      <div class="uploadForm" style="display:none;">
        <!-- The fileinput-button span is used to style the file input field as button -->
        <span class="btn btn-success fileinput-button">
            <i class="glyphicon glyphicon-plus"></i>
            <span>Add files...</span>
            <!-- The file input field used as target for the file upload widget -->
            <input id="fileupload" type="file" name="files[]" multiple>
        </span>
        <button class="btn btn-primary" id="uploadAll">
          <i class="glyphicon glyphicon-upload"></i>
          Upload All
        </button>
        <button class="btn btn-warning cancel" id="clearAll">
            <i class="glyphicon glyphicon-ban-circle"></i>
            Clear Uploads
        </button>
        <br>
        Drag and drop anywhere on the page
        <br>
        <!-- The global progress bar -->
        <div id="progress" class="progress">
            <div class="progress-bar progress-bar-success"></div>
        </div>
        <!-- The container for the uploaded files -->
        <div id="files" class="files"></div>
        <br/>
        <div id="dropzone">Drop files anywhere</div>
      </div>

      <data id="chunksize" tal:attributes="data view/chunksize" />

      <script tal:attributes="src string:${portal_url}/++resource++ims.upload/upload.js"></script>

      <div id="folder-contents" style="display:none;">
        <h3>Files in process or aborted</h3>
        <div id="upload-chunks-listing">
        <img src="spinner.gif" class="upload-spinner" />
          loading...
        </div>

        <form tal:attributes="action context/absolute_url" method="POST">
          <h3>Contents</h3>
          <div id="upload-folder-listing">
            <img src="spinner.gif" class="upload-spinner" />
            loading...
          </div>
          <input tal:replace="structure context/@@authenticator/authenticator" />
        </form>
      </div>

      <script type="text/javascript">
        $(document).ready(function() {
          $.ajaxSetup({ cache: false });
          $('#folder-contents').toggle();
          if (xhr_support()) {
            $('#fileupload-chunkless').remove();
            $('.uploadForm').toggle();
          }
          refreshlisting()
        });
      </script>
    </div>

</body>
</html>